<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Paper.io with Star Players</title>
<style>
  canvas { border: 2px solid #333; background: #eee; display:block; margin: auto; }
  body { text-align:center; font-family: sans-serif; }
</style>
</head>
<body>
<h1>Mini Paper.io</h1>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const gridW = canvas.width;
const gridH = canvas.height;

// Helper: create a circular polygon for initial territory
function createCirclePolygon(x, y, r, points=16){
    const poly = [];
    for(let i=0;i<points;i++){
        const angle = (i/points)*2*Math.PI;
        poly.push({x: x + r*Math.cos(angle), y: y + r*Math.sin(angle)});
    }
    return poly;
}

// Draw a star at (x,y) with radius r
function drawStar(ctx, x, y, r, color){
    ctx.fillStyle = color;
    ctx.beginPath();
    for(let i=0;i<5;i++){
        const angle = i * (2*Math.PI)/5 - Math.PI/2;
        const x1 = x + r * Math.cos(angle);
        const y1 = y + r * Math.sin(angle);
        const angle2 = angle + Math.PI/5;
        const x2 = x + r/2 * Math.cos(angle2);
        const y2 = y + r/2 * Math.sin(angle2);
        if(i===0) ctx.moveTo(x1,y1);
        else ctx.lineTo(x1,y1);
        ctx.lineTo(x2,y2);
    }
    ctx.closePath();
    ctx.fill();
}

class Player {
    constructor(x, y, color, keys) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.keys = keys;
        this.dir = {x:0,y:0};
        this.speed = 3;
        this.territory = createCirclePolygon(x, y, 20); // small initial circle
        this.trail = [];
        this.alive = true;
    }
    
    move() {
        if(!this.alive) return;
        this.x += this.dir.x * this.speed;
        this.y += this.dir.y * this.speed;
        this.x = Math.max(0, Math.min(gridW, this.x));
        this.y = Math.max(0, Math.min(gridH, this.y));
        // leave trail if outside territory
        if(!this.insideTerritory()) {
            this.trail.push({x:this.x,y:this.y});
        } else if(this.trail.length > 0) {
            // closed trail -> add to territory
            this.territory.push(...this.trail);
            this.trail = [];
        }
    }
    
    insideTerritory() {
        let x = this.x, y = this.y;
        let inside = false;
        const poly = this.territory;
        for (let i = 0, j = poly.length - 1; i < poly.length; j = i++) {
            const xi = poly[i].x, yi = poly[i].y;
            const xj = poly[j].x, yj = poly[j].y;
            const intersect = ((yi>y)!=(yj>y)) && (x < (xj-xi)*(y-yi)/(yj-yi)+xi);
            if(intersect) inside = !inside;
        }
        return inside;
    }
    
    draw() {
        // draw territory
        ctx.fillStyle = this.color + "66";
        if(this.territory.length>0){
            ctx.beginPath();
            ctx.moveTo(this.territory[0].x,this.territory[0].y);
            for(let p of this.territory) ctx.lineTo(p.x,p.y);
            ctx.closePath();
            ctx.fill();
        }
        // draw trail
        if(this.trail.length>0){
            ctx.strokeStyle = this.color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(this.trail[0].x,this.trail[0].y);
            for(let p of this.trail) ctx.lineTo(p.x,p.y);
            ctx.stroke();
        }
        // draw star player
        drawStar(ctx, this.x, this.y, 10, this.color);
    }
}

const player1 = new Player(200,300,'blue',{up:38,down:40,left:37,right:39});
const player2 = new Player(600,300,'red',{up:87,down:83,left:65,right:68});

const players = [player1, player2];
const keysDown = {};
document.addEventListener('keydown', e => keysDown[e.keyCode]=true);
document.addEventListener('keyup', e => keysDown[e.keyCode]=false);

function handleInput(){
    for(let p of players){
        if(!p.alive) continue;
        let dx=0,dy=0;
        if(keysDown[p.keys.up]) dy=-1;
        if(keysDown[p.keys.down]) dy=1;
        if(keysDown[p.keys.left]) dx=-1;
        if(keysDown[p.keys.right]) dx=1;
        if(dx!==0 || dy!==0){
            const mag = Math.sqrt(dx*dx+dy*dy);
            p.dir.x = dx/mag;
            p.dir.y = dy/mag;
        } else {
            p.dir.x = 0; p.dir.y = 0;
        }
    }
}

// collision with other players' trails only
function checkCollisions(){
    for(let p of players){
        if(!p.alive) continue;
        for(let other of players){
            if(other === p) continue; // skip self
            for(let t of other.trail){
                if(Math.hypot(p.x - t.x, p.y - t.y) < 6){
                    p.alive = false;
                    alert(p.color + " lost!");
                }
            }
        }
    }
}

function gameLoop(){
    ctx.clearRect(0,0,gridW,gridH);
    handleInput();
    for(let p of players){
        p.move();
        p.draw();
    }
    checkCollisions();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
